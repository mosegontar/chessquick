{% extends 'base.html' %}

<!-- <span id="status"></span></i>{% if round_date %} Last move:{{ round_date }} {% endif %}-->

{% block information %}
<div class=playerInfo>
    <table>
        <tr>
            <span id=table_head_white><th style='font-family: monospace;'></th></span>
            <th> Status: </th>
            <th id=table_head_black></th>
        </tr>
        <tr>
            <td id=whiteplayer>Guest</td>
            <td id=status>
            <td id='blackplayer'">Guest</td>
        </tr>
    </table>
</div>
<br/>
{% endblock %}


{% block content %}
<div class=main_game>
    <script>
        function share()  {
            prompt("Share your game with this link!", "{{ root_path }}"+"{{ game_url }}");
        };
        
        var updatePlayerStatus = function (white, black) {
            document.getElementById('whiteplayer').textContent = white;
            document.getElementById('blackplayer').textContent = black;
        }
        updatePlayerStatus("{{ taken_players['w'] }}", "{{ taken_players['b'] }}");        
    </script>

    <div id="board"></div>
    <script>
        var current_player = '{{ current_player }}'
        var current_fen = '{{ fen }}';
        var root_path = '{{ root_path }}';

        var unsave = function () {
            $.getJSON($SCRIPT_ROOT +'/_save', {
                action: "unsave",
                match_url: "{{ game_url }}",
                current_player: current_player,
            }, function(data) {
                 $("#save_span").replaceWith('<span id=save_span><a id=save href="#" onclick=save();>Save!</a> |</span>');
                updatePlayerStatus(data.white_player_name, data.black_player_name);             
         })};        


        var save = function () {
            $.getJSON($SCRIPT_ROOT +'/_save', {
                action: "save",
                match_url: "{{ game_url }}",
                current_player: current_player,
            }, function(data) {
                $("#save_span").replaceWith('<span id=save_span><a id=unsave href="#" onclick=unsave();>Un-save!</a> |</span>');
                updatePlayerStatus(data.white_player_name, data.black_player_name);
         })};

        var unnotify = function () {
            $.getJSON($SCRIPT_ROOT +'/_notify', {
                action: "unnotify",
                match_url: "{{ game_url }}",
            }, function(data) {
                 $("#notify_span").replaceWith('<span id=notify_span><a id=notify href="#" onclick=notify();>Notify: Off</a> |</span>');
         })};        


        var notify = function () {
            $.getJSON($SCRIPT_ROOT +'/_notify', {
                action: "notify",
                match_url: "{{ game_url }}",
            }, function(data) {
                $("#notify_span").replaceWith('<span id=notify_span><a id=unnotify href="#" onclick=unnotify();>Notify: On</a> |</span>');
         })};            

    </script>

    <script src="{{url_for('static', filename='js/game.js') }} "></script>

    <p></p>

    <div class="buttons">
        <button id=undo_move>Undo Move</button>
        <button id=submit_move>Submit Move</button>        

        {% if game_url|length > 1 %}
            <button id=share_button onClick="share()">Share Game!</button>
        {% endif %} 
    </div>

    {% if game_url|length > 1 and taken_players[current_player] == 'Guest' and current_user.username not in taken_players %}
        <script>
            $("#save_span").replaceWith('<span id=save_span><a id=save href="#" onclick=save();>Save!</a> |</span>');
        </script>
    {% elif game_url|length > 1 and current_user.username in taken_players.values() %}
        <script>
            $("#save_span").replaceWith('<span id=save_span><a id=unsave href="#" onclick=unsave();>Un-save!</a> |</span>');
        </script>        
    {% endif %}
    {% if current_user.username in taken_players.values() %}
        {% if not current_match.white_notify o %}
            <script>
                 $("#notify_span").replaceWith('<span id=notify_span><a id=notify href="#" onclick=notify();>Notify: Off</a> |</span>');
            </script>
        {% else %}
            <script>
                $("#notify_span").replaceWith('<span id=notify_span><a id=unnotify href="#" onclick=unnotify();>Notify: On</a> |</span>');
            </script>
        {% endif %} 

    {% endif %}




</div>
{% endblock %}